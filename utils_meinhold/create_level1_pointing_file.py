# This generates adjusted level1 pointing  file
# first function read dataimport numpy as np
import pylab
import numpy 
import pyfits
import os
import sys
import cPickle
import cofe_util as util
import numpy as np
wd='/cofe/flight_data/Level1/1.2/'
chans=[1,3,5,9,11,13]

azf15=pyfits.open(wd+'fixaz.fits')
gaz=azf15['15GHZ'].data['AZ']
ut=azf15['15GHZ'].data['UT']

#Load the old fit parameters and crossing data inputs
f=open(wd+'fitparams_moonfixed_15.pkl')
fitdic=cPickle.load(f)
f.close()
f=open(wd+'eltarget_15.pkl')
eltargetdic=cPickle.load(f)
f.close()

#create a blank list to store the column 
nsamps=len(gaz)
elzero=np.zeros(nsamps,dtype=np.float32)
cols=[]
for i,c in enumerate(chans):
    cols.append(pyfits.Column(name='az'+str(c),format='Float32',array=np.mod(gaz*util.rtd+fitdic[c][0]+fitdic[c][1]*ut,360.)))
    cols.append(pyfits.Column(name='el'+str(c),format='Float32',array=elzero+eltargetdic[c][2]))
    cols.append(pyftis.Column(name='ut',format='Float32',array=ut))
coldefinitions=pyfits.ColDefs(cols)
tablehdu=pyfits.new_table(coldefinitions)
tablehdu.writeto(wd+'all_15ghz_pointing.fits',clobber=True)


#Now do 10 GHz
chans=[1,3,5]
azf10=pyfits.open(wd+'fixaz.fits')
gaz=azf10['10GHZ'].data['AZ']
ut=azf10['10GHZ'].data['UT']

f=open(wd+'fitparams_moonfixed_10.pkl')
fitdic=cPickle.load(f)
f.close()
f=open(wd+'eltarget_10.pkl')
eltargetdic=cPickle.load(f)
f.close()

#create a blank list to store the column 
nsamps=len(gaz)
elzero=np.zeros(nsamps,dtype=np.float32)
cols=[]
for i,c in enumerate(chans):
    cols.append(pyfits.Column(name='az'+str(c),format='Float32',array=np.mod(gaz*util.rtd+fitdic[c][0]+fitdic[c][1]*ut,360.)))
    cols.append(pyfits.Column(name='el'+str(c),format='Float32',array=elzero+eltargetdic[c][2]))
coldefinitions=pyfits.ColDefs(cols)
tablehdu=pyfits.new_table(coldefinitions)
tablehdu.writeto(wd+'all_10ghz_pointing.fits',clobber=True)




























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































